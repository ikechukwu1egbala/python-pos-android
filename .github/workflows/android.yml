      name: Build Android APK
      
      on:
        push:
          branches: [ "main" ]
      
      jobs:
        build:
          runs-on: ubuntu-latest
      
          steps:
          # 1Ô∏è‚É£ Checkout
          - name: Checkout code
            uses: actions/checkout@v4
      
          # 2Ô∏è‚É£ Force Java 17 (VERY IMPORTANT)
          - name: Force Java 17
            run: |
              echo "JAVA_HOME=/usr/lib/jvm/temurin-17-jdk-amd64" >> $GITHUB_ENV
              echo "/usr/lib/jvm/temurin-17-jdk-amd64/bin" >> $GITHUB_PATH
      
          # 3Ô∏è‚É£ Install system dependencies
          - name: Install system dependencies
            run: |
              sudo apt update
              sudo apt install -y \
                python3-pip \
                openjdk-17-jdk \
                unzip zip \
                pkg-config \
                libffi-dev \
                libssl-dev \
                libbz2-dev \
                liblzma-dev \
                zlib1g-dev \
                libsqlite3-dev \
                libncurses5-dev \
                libncursesw5-dev \
                libreadline-dev \
                libxml2-dev \
                llvm \
                clang
      
          # 4Ô∏è‚É£ Fix Cython (jnius error fix)
          - name: Force compatible Cython
            run: |
              pip uninstall -y cython || true
              pip install "cython<3"
      
          # 5Ô∏è‚É£ Install buildozer + tools
          - name: Install Python tools
            run: |
              pip install --upgrade pip
              pip install buildozer virtualenv
      
          # 6Ô∏è‚É£ Install Android command-line tools
          - name: Install Android SDK tools
            run: |
              mkdir -p $HOME/android-sdk/cmdline-tools
              cd $HOME/android-sdk
              curl -o cmdline-tools.zip https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
              unzip cmdline-tools.zip -d cmdline-tools
              mv cmdline-tools/cmdline-tools cmdline-tools/latest
      
          # 7Ô∏è‚É£ Set Android environment variables
          - name: Set Android environment
            run: |
              echo "ANDROID_HOME=$HOME/android-sdk" >> $GITHUB_ENV
              echo "ANDROID_SDK_ROOT=$HOME/android-sdk" >> $GITHUB_ENV
              echo "$HOME/android-sdk/cmdline-tools/latest/bin" >> $GITHUB_PATH
      
          # 8Ô∏è‚É£ Accept ALL SDK licenses (CRITICAL)
          - name: Accept Android SDK licenses
            run: |
              yes | sdkmanager --licenses
      
          # 9Ô∏è‚É£ Install ONLY required Android packages (NO 36.x)
          - name: Install required Android packages
            run: |
              sdkmanager \
                "platform-tools" \
                "platforms;android-33" \
                "build-tools;33.0.2" \
                "ndk;25.2.9519653"
      
          # üîü HARD clean (prevents cached corruption)
          - name: Hard clean build caches
            run: |
              rm -rf ~/.buildozer
              rm -rf ~/.android
              rm -rf ~/.cache/python-for-android
      
          # 1Ô∏è‚É£1Ô∏è‚É£ Build APK
          - name: Build APK
            run: |
              buildozer -v android debug
      
          # 1Ô∏è‚É£2Ô∏è‚É£ Upload APK
          - name: Upload APK
            uses: actions/upload-artifact@v4
            with:
              name: python-pos-apk
              path: bin/*.apk
